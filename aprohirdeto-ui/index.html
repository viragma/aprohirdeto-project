<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ Falusi PortÃ©ka Piac ğŸŒ¾</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f5f1e8;
            font-family: Georgia, serif;
            padding: 20px;
        }
        
        .header-box {
            background: linear-gradient(135deg, #8b4513, #a0522d);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            border: 4px solid #654321;
        }
        
        .ad-box {
            background: white;
            border: 3px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .ad-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .btn-falusi {
            background: #228b22;
            color: white;
            border: 3px solid #006400;
            font-weight: bold;
            padding: 12px 25px;
        }
        
        .btn-falusi:hover {
            background: #32cd32;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-box">
            <h1>ğŸ„ FALUSI PORTÃ‰KA PIAC ğŸŒ¾</h1>
            <p class="lead">Itt minden holmi eladÃ³, amit a gazda nem vitt haza!</p>
        </div>

        <div class="ad-box">
            <h3>ğŸ– Tedd fel a portÃ©kÃ¡dat!</h3>
            <form id="adForm">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">ğŸŒ¾ Mit akarsz eladni? *</label>
                        <input type="text" class="form-control" name="ad_title" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">ğŸ¤  A te neved? *</label>
                        <input type="text" class="form-control" name="seller_name" required>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">ğŸ’° MennyiÃ©rt?</label>
                        <input type="text" class="form-control" name="price" placeholder="pl. 5000 Ft">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">ğŸ“ TelefonszÃ¡m</label>
                        <input type="tel" class="form-control" name="phone">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">ğŸ“ MesÃ©lj rÃ³la!</label>
                    <textarea class="form-control" name="ad_text" rows="3"></textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">ğŸ“· KÃ©p feltÃ¶ltÃ©se</label>
                    <input type="file" class="form-control" name="image" accept="image/*">
                </div>
                
                <button type="submit" class="btn btn-falusi">ğŸ– Fel a portÃ©kÃ¡val!</button>
            </form>
            
            <div id="message" class="mt-3"></div>
        </div>

        <div class="ad-box">
            <h3>ğŸª LÃ¡ssuk, mit Ã¡rulnak a tanyasiak!</h3>
            <div id="adsList">
                <p class="text-center">ğŸ„ BetÃ¶ltÃ©s...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Az eredeti API URL-t hasznÃ¡ljuk, mivel az UI Ã©s az API kÃ¼lÃ¶n szerveren van.
        const API_URL = 'http://beadando-lb-555305300.eu-central-1.elb.amazonaws.com/api/ads';
        
        // Az S3 bucket URL-je, ahol a kÃ©pek tÃ¡rolÃ³dnak.
        const S3_BUCKET_URL = 'https://beadando-kepek-w4pp9o.s3.eu-central-1.amazonaws.com/';
        
        // HirdetÃ©sek betÃ¶ltÃ©se
        async function loadAds() {
            const adsList = document.getElementById('adsList');
            
            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`Nem sikerÃ¼lt betÃ¶lteni a portÃ©kÃ¡t! (StÃ¡tusz: ${response.status})`);
                }
                
                const ads = await response.json();
                
                // Ez a rÃ©sz okozza a "villanÃ¡st", amikor az adatbÃ¡zis Ã¼res
                if (!ads || ads.length === 0) {
                    adsList.innerHTML = '<p class="text-center">ğŸŒ¾ MÃ©g nincs hirdetÃ©s!</p>';
                    return;
                }
                
                adsList.innerHTML = '';
                
                ads.forEach(ad => {
                    const div = document.createElement('div');
                    div.className = 'card mb-3';
                    div.style.border = '2px solid #8b4513';
                    
                    let html = '<div class="card-body">';
                    
                    // === KÃ‰P MEGJELENÃTÃ‰S JAVÃTÃSA ===
                    // Az API 'thumbnail_url' vagy 'image_url' kulcsot kÃ¼ld.
                    // Ezt hasznÃ¡ljuk, Ã©s elÃ© illesztjÃ¼k az S3 bucket cÃ­mÃ©t.
                    
                    // ElÅ‘szÃ¶r a thumbnailt prÃ³bÃ¡ljuk, ha nincs, akkor a teljes kÃ©pet
                    let imageKey = ad.thumbnail_url || ad.image_url;
                    
                    if (imageKey) {
                        const fullImageUrl = S3_BUCKET_URL + imageKey;
                        html += `<img src="${fullImageUrl}" class="ad-image" alt="${ad.ad_title || 'KÃ©p'}">`;
                    }
                    // === JAVÃTÃS VÃ‰GE ===
                    
                    // Tartalom
                    html += `
                        <h5 class="card-title">ğŸŒ¾ ${ad.ad_title || 'NÃ©vtelen'}</h5>
                        ${ad.price ? `<p class="text-success fw-bold">ğŸ’° ${ad.price}</p>` : ''}
                        <p><strong>ğŸ¤  EladÃ³:</strong> ${ad.seller_name || 'Ismeretlen'}</p>
                        ${ad.ad_text ? `<p>${ad.ad_text}</p>` : ''}
                        ${ad.phone ? `<p><strong>ğŸ“</strong> ${ad.phone}</p>` : ''}
                        ${ad.email ? `<p><strong>ğŸ“§</strong> ${ad.email}</p>` : ''}
                    `;
                    
                    html += '</div>';
                    div.innerHTML = html;
                    adsList.appendChild(div);
                });
                
            } catch (error) {
                console.error('Hiba a hirdetÃ©sek betÃ¶ltÃ©sekor:', error);
                adsList.innerHTML = `<p class="text-danger text-center">Hiba: ${error.message}</p>`;
            }
        }
        
        // Å°rlap kezelÃ©s
        document.getElementById('adForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const message = document.getElementById('message');
            const submitBtn = e.target.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'â³ FeltÃ¶ltÃ©s...';
                
                const formData = new FormData(e.target);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Ismeretlen hiba' }));
                    throw new Error(errorData.message || `Hiba tÃ¶rtÃ©nt! (StÃ¡tusz: ${response.status})`);
                }
                
                message.innerHTML = '<div class="alert alert-success">âœ… Sikeresen feladva!</div>';
                e.target.reset();
                
                // ÃšjratÃ¶ltjÃ¼k a hirdetÃ©seket (most mÃ¡r meg fog jelenni az Ãºj)
                loadAds();
                
                setTimeout(() => {
                    message.innerHTML = '';
                }, 3000);
                
            } catch (error) {
                console.error('Hiba a hirdetÃ©s feladÃ¡sakor:', error);
                message.innerHTML = `<div class="alert alert-danger">âŒ ${error.message}</div>`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ– Fel a portÃ©kÃ¡val!';
            }
        });
        
        // BetÃ¶ltÃ©s indÃ­tÃ¡sa
        loadAds();
    </script>
</body>
</html>